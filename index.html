<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch h·ªì s∆° l∆∞u th√°ng 7/2025</title>
  <style>
    /* ---------- Cursors ---------- */
    body, button { cursor: pointer; }

    /* ---------- Page style ---------- */
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
      padding: 40px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .container {
      background: white;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 700px;
      position: relative;
    }
    .header-info {
      text-align: center; margin-bottom: 10px;
      font-size: 13px; color: #666;
    }
    h1 {
      text-align: center; margin-bottom: 20px;
      font-size: 20px; color: #333;
    }

    /* ---------- Table ---------- */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      border-radius: 10px; overflow: hidden;
      opacity: 0; transition: opacity 0.5s ease;
    }
    th, td {
      padding: 10px 8px;
      text-align: center;
      border: 1px solid #ddd;
      white-space: nowrap;
    }
    tbody tr:nth-child(even):not(.received):not(.not-received) {
      background-color: #f9f9f9;
    }
    tr.received {
      background-color: #d4edda !important;
      color: #155724;
    }
    tr.not-received {
      background-color: #f8d7da !important;
      color: #721c24;
    }
    tbody tr:hover {
      background-color: #e8f0fe !important;
    }

    /* ---------- Buttons ---------- */
    .btn {
      font-size: 16px; padding: 4px 8px;
      border: none; background: none;
      transition: transform 0.2s, opacity 0.2s;
    }
    .tick { color: green; }
    .cross { color: red; }
    .default-cross { font-size: 22px; }
    .selected { transform: scale(1.3); }
    .disabled { opacity: 0.5; pointer-events: none; }

    /* ---------- Action Buttons ---------- */
    .button-row {
      margin-top: 20px; text-align: center;
    }
    .action-btn {
      padding: 10px 20px; margin: 0 10px;
      border: none; color: white; border-radius: 6px;
      font-weight: bold; cursor: pointer;
      transition: background 0.2s;
    }
    .action-btn:nth-child(1) { background:#007bff; }
    .action-btn:nth-child(1):hover { background:#0056b3; }
    .danger-btn { background:#dc3545; }
    .danger-btn:hover { background:#a72836; }

    /* ---------- Modal ---------- */
    .modal {
      display:none; position:fixed; z-index:999;
      left:0; top:0; width:100%; height:100%;
      background-color:rgba(0,0,0,0.5);
      align-items:center;
      justify-content:center;
    }
    .modal-content {
      background:#fff; padding:20px 30px;
      border-radius:12px; text-align:center;
      box-shadow:0 8px 20px rgba(0,0,0,0.25);
      animation:fadeIn 0.3s ease;
    }
    .modal-content p {
      font-size:16px; margin-bottom:15px;
    }
    .modal-buttons {
      margin-top:10px;
    }
    .modal-buttons button {
      padding:8px 16px; margin:0 8px;
      border:none;border-radius:6px;
      font-size:14px;font-weight:bold;
      cursor:pointer;
    }
    .confirm-btn { background: #28a745; color: white; }
    .cancel-btn { background: #dc3545; color: white; }
    input[type="password"] {
      padding:8px; width:80%; border:1px solid #ccc;
      font-size:14px; border-radius:6px;
    }

    @keyframes fadeIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* ---------- Skeleton loading ---------- */
    .skeleton {
      animation: shimmer 1.5s infinite;
      background: linear-gradient(to right, #eee 8%, #ddd 18%, #eee 33%);
      background-size: 800px 104px;
    }
    .skeleton-row td {
      height: 20px;
      border-color: transparent;
      background-color: #eee;
    }
    @keyframes shimmer {
      0% { background-position: -800px 0; }
      100% { background-position: 800px 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-info">
      Qu·∫£n l√Ω h·ªì s∆° b·ªüi <strong>D∆∞∆°ng</strong><br>
      <span>Code b·ªüi Nguy·ªÖn B√¨nh D∆∞∆°ng üòé</span>
    </div>
    <h1>Danh s√°ch h·ªì s∆° l∆∞u th√°ng 7/2025</h1>
    <div id="table-wrapper">
      <table id="list">
        <thead>
          <tr>
            <th>STT</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ng√†y x√°c nh·∫≠n</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="button-row">
      <button class="action-btn" onclick="exportToExcel()">üßæ Xu·∫•t Excel</button>
      <button class="action-btn danger-btn" onclick="promptReset()">üóëÔ∏è Xo√° d·ªØ li·ªáu</button>
    </div>
  </div>

  <!-- Popup v√† Modals -->
  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <p id="confirmText"></p>
      <div class="modal-buttons">
        <button class="confirm-btn" id="confirmYes">X√°c nh·∫≠n</button>
        <button class="cancel-btn" id="confirmNo">Hu·ª∑</button>
      </div>
    </div>
  </div>
  <div class="modal" id="passwordModal">
    <div class="modal-content">
      <p>Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ xo√° to√†n b·ªô d·ªØ li·ªáu:</p>
      <input type="password" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <div class="modal-buttons">
        <button class="confirm-btn" onclick="confirmReset()">X√°c nh·∫≠n</button>
        <button class="cancel-btn" onclick="closePasswordModal()">Hu·ª∑</button>
      </div>
    </div>
  </div>

  <!-- Th∆∞ vi·ªán xu·∫•t Excel -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script>
    const tbody = document.querySelector("#list tbody");
    const savedStatus = JSON.parse(localStorage.getItem("hoso_status")) || {};

    const modal = document.getElementById("confirmModal");
    const confirmText = document.getElementById("confirmText");
    const yesBtn = document.getElementById("confirmYes");
    const noBtn = document.getElementById("confirmNo");

    const pwdModal = document.getElementById("passwordModal");
    const pwdInput = document.getElementById("passwordInput");
    let pendingAction = null;

    function showModal(msg, cb) {
      confirmText.textContent = msg;
      modal.style.display = "flex";
      pendingAction = cb;
    }
    yesBtn.onclick = () => { pendingAction && pendingAction(); modal.style.display = "none"; pendingAction=null; };
    noBtn.onclick = () => { modal.style.display = "none"; pendingAction=null; };

    function promptReset() {
      pwdInput.value = '';
      pwdModal.style.display = "flex";
      pwdInput.focus();
    }
    function closePasswordModal() { pwdModal.style.display = "none"; }
    function confirmReset() {
      const secret = atob("dHVuZ2R1b25naGo=");
      if (pwdInput.value === secret) {
        localStorage.removeItem("hoso_status");
        location.reload();
      } else alert("Sai m·∫≠t kh·∫©u!");
    }

    function createSkeleton(rows=10) {
      for (let i=0; i<rows; i++) {
        const tr = document.createElement("tr");
        tr.className = "skeleton-row";
        for (let k=0; k<4; k++) {
          const td = document.createElement("td");
          td.className = "skeleton";
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }
    }

    function loadData() {
      tbody.innerHTML = '';
      for (let i = 864; i <= 1000; i++) {
        const row = document.createElement("tr");
        const rowId = `stt_${i}`;
        const saved = savedStatus[rowId];

        row.innerHTML = `
          <td>${i}</td>
          <td class="status">Ch∆∞a nh·∫≠n h·ªì s∆° l∆∞u</td>
          <td class="date">-</td>
          <td>
            <button class="btn tick">‚úÖ</button>
            <button class="btn cross default-cross">‚ùå</button>
          </td>
        `;

        const tickBtn = row.querySelector(".tick");
        const crossBtn = row.querySelector(".cross");
        const statusCell = row.querySelector(".status");
        const dateCell = row.querySelector(".date");

        const applyStatus = (type, time=null) => {
          const now = time || new Date().toLocaleString('vi-VN');
          if (type === 'received') {
            row.classList.add("received");
            statusCell.innerHTML = "‚úÖ ƒê√£ nh·∫≠n h·ªì s∆° l∆∞u";
            tickBtn.classList.add("selected", "disabled");
            crossBtn.classList.add("disabled");
          } else {
            row.classList.add("not-received");
            statusCell.innerHTML = "‚ùå Ch∆∞a nh·∫≠n h·ªì s∆° l∆∞u";
            crossBtn.classList.add("selected");
          }
          dateCell.textContent = now;
          savedStatus[rowId] = {type, date: now};
          localStorage.setItem("hoso_status", JSON.stringify(savedStatus));
        };

        tickBtn.onclick = () => showModal(`X√°c nh·∫≠n ƒë√£ nh·∫≠n h·ªì s∆° s·ªë ${i}?`, () => applyStatus('received'));
        crossBtn.onclick = () => showModal(`X√°c nh·∫≠n ch∆∞a nh·∫≠n h·ªì s∆° s·ªë ${i}?`, () => applyStatus('not-received'));

        if (saved && saved.type) applyStatus(saved.type, saved.date);
        else row.classList.add("not-received");

        tbody.appendChild(row);
      }
      document.querySelector("table").style.opacity = 1;
    }

    window.addEventListener('DOMContentLoaded', () => {
      createSkeleton(10);
      setTimeout(loadData, 600);
    });

    function exportToExcel() {
      const data = [["STT","Tr·∫°ng th√°i","Ng√†y x√°c nh·∫≠n"]];
      tbody.querySelectorAll("tr").forEach(r => {
        const [stt,s,date] = [r.children[0].textContent, r.children[1].textContent, r.children[2].textContent];
        data.push([stt, s, date]);
      });
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "HoSo7");
      XLSX.writeFile(wb, "HoSo_Luu_Thang7_2025.xlsx");
    }
  </script>
</body>
</html>
